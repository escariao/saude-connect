<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Profissional - Saúde Connect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">Saúde Connect</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Início</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="busca.html">Buscar Profissionais</a>
                    </li>
                    <li class="nav-item" id="nav-cadastro-paciente">
                        <a class="nav-link" href="cadastro-paciente.html">Cadastro Paciente</a>
                    </li>
                    <li class="nav-item" id="nav-cadastro-profissional">
                        <a class="nav-link" href="cadastro-profissional.html">Cadastro Profissional</a>
                    </li>
                    <li class="nav-item" id="nav-login">
                        <a class="nav-link" href="login.html">Login</a>
                    </li>
                    <li class="nav-item d-none" id="nav-perfil">
                        <a class="nav-link" href="#" id="perfil-link">Meu Perfil</a>
                    </li>
                    <li class="nav-item d-none" id="nav-admin">
                        <a class="nav-link" href="admin.html">Painel Admin</a>
                    </li>
                    <li class="nav-item d-none" id="nav-logout">
                        <a class="nav-link" href="#" id="logout-link">Sair</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="py-5 bg-light">
        <div class="container">
            <div id="loading-container" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <p class="mt-3">Carregando informações do profissional...</p>
            </div>
            
            <div id="error-container" class="d-none">
                <div class="alert alert-danger">
                    <h4 class="alert-heading">Erro ao carregar informações</h4>
                    <p id="error-message">Ocorreu um erro ao carregar as informações do profissional.</p>
                    <hr>
                    <p class="mb-0">
                        <a href="busca.html" class="alert-link">Voltar para a busca</a>
                    </p>
                </div>
            </div>
            
            <div id="professional-details" class="d-none">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="profile-image mb-3">
                                    <i class="bi bi-person-circle" style="font-size: 5rem; color: var(--primary-color);"></i>
                                </div>
                                <h3 id="prof-name" class="card-title mb-1">Nome do Profissional</h3>
                                <p id="prof-categories" class="text-muted mb-3">Categorias</p>
                                <div class="d-grid gap-2">
                                    <a href="#" class="btn btn-primary" id="contact-btn">
                                        <i class="bi bi-envelope-fill me-2"></i>Entrar em Contato
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-body">
                                <h5 class="card-title">Informações de Contato</h5>
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="bi bi-envelope me-2"></i>
                                        <span id="prof-email">email@exemplo.com</span>
                                    </li>
                                    <li class="mb-2">
                                        <i class="bi bi-telephone me-2"></i>
                                        <span id="prof-phone">(00) 00000-0000</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4 class="card-title">Sobre o Profissional</h4>
                                <p id="prof-bio" class="card-text">Biografia do profissional...</p>
                            </div>
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4 class="mb-0">Especialidades e Serviços</h4>
                            </div>
                            <div class="card-body">
                                <div id="prof-activities">
                                    <!-- Atividades serão inseridas aqui -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4 class="mb-0">Qualificações</h4>
                            </div>
                            <div class="card-body">
                                <p>
                                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                                    <span>Profissional verificado e aprovado pela Saúde Connect</span>
                                </p>
                                <p>
                                    <i class="bi bi-award me-2"></i>
                                    <span>Diploma/Certificação validada</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de Contato -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contatar Profissional</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="contact-form">
                        <div class="mb-3">
                            <label for="contact-name" class="form-label">Seu Nome</label>
                            <input type="text" class="form-control" id="contact-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="contact-email" class="form-label">Seu Email</label>
                            <input type="email" class="form-control" id="contact-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="contact-phone" class="form-label">Seu Telefone</label>
                            <input type="tel" class="form-control" id="contact-phone">
                        </div>
                        <div class="mb-3">
                            <label for="contact-message" class="form-label">Mensagem</label>
                            <textarea class="form-control" id="contact-message" rows="4" required></textarea>
                        </div>
                        <div id="contact-alert" class="mb-3"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="send-contact">Enviar Mensagem</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Saúde Connect</h5>
                    <p>Conectando profissionais de saúde e pacientes de forma simples, segura e eficiente.</p>
                </div>
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Links Rápidos</h5>
                    <ul class="list-unstyled footer-links">
                        <li><a href="index.html">Início</a></li>
                        <li><a href="busca.html">Buscar Profissionais</a></li>
                        <li><a href="cadastro-paciente.html">Cadastro Paciente</a></li>
                        <li><a href="cadastro-profissional.html">Cadastro Profissional</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contato</h5>
                    <ul class="list-unstyled footer-links">
                        <li><a href="mailto:contato@saudeconnect.com">contato@saudeconnect.com</a></li>
                        <li><a href="tel:+551199999999">(11) 9999-9999</a></li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4 mb-3">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 Saúde Connect. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação e atualizar menu
            updateNavigation();
            
            // Obter ID do profissional da URL
            const urlParams = new URLSearchParams(window.location.search);
            const professionalId = urlParams.get('id');
            
            if (!professionalId) {
                showError('ID do profissional não fornecido');
                return;
            }
            
            // Carregar detalhes do profissional
            loadProfessionalDetails(professionalId);
            
            // Configurar botão de contato
            document.getElementById('contact-btn').addEventListener('click', function(e) {
                e.preventDefault();
                const contactModal = new bootstrap.Modal(document.getElementById('contactModal'));
                contactModal.show();
            });
            
            // Configurar envio de mensagem
            document.getElementById('send-contact').addEventListener('click', function() {
                sendContactMessage(professionalId);
            });
            
            // Configurar logout
            document.getElementById('logout-link')?.addEventListener('click', function(e) {
                e.preventDefault();
                window.api.logout();
                window.location.href = 'index.html';
            });
        });
        
        function updateNavigation() {
            if (window.api.isAuthenticated()) {
                const userData = window.api.getUserData();
                
                // Ocultar links de cadastro e login
                document.getElementById('nav-cadastro-paciente').classList.add('d-none');
                document.getElementById('nav-cadastro-profissional').classList.add('d-none');
                document.getElementById('nav-login').classList.add('d-none');
                
                // Mostrar link de logout
                document.getElementById('nav-logout').classList.remove('d-none');
                
                // Mostrar link de perfil apropriado
                document.getElementById('nav-perfil').classList.remove('d-none');
                
                const perfilLink = document.getElementById('perfil-link');
                if (userData.user_type === 'professional') {
                    perfilLink.href = `perfil-profissional.html?id=${userData.id}`;
                } else if (userData.user_type === 'patient') {
                    perfilLink.href = `perfil-paciente.html?id=${userData.id}`;
                }
                
                // Mostrar link de admin se for administrador
                if (userData.user_type === 'admin') {
                    document.getElementById('nav-admin').classList.remove('d-none');
                }
            }
        }
        
        async function loadProfessionalDetails(professionalId) {
            try {
                const response = await fetch(`/api/professionals/${professionalId}`);
                
                if (!response.ok) {
                    throw new Error('Falha ao carregar detalhes do profissional');
                }
                
                const professional = await response.json();
                
                // Preencher informações do profissional
                document.getElementById('prof-name').textContent = professional.name;
                document.getElementById('prof-email').textContent = professional.email || 'Email não disponível';
                document.getElementById('prof-phone').textContent = professional.phone || 'Telefone não disponível';
                document.getElementById('prof-bio').textContent = professional.bio || 'Biografia não disponível';
                
                // Preencher categorias
                if (professional.categories && professional.categories.length > 0) {
                    document.getElementById('prof-categories').textContent = professional.categories.map(cat => cat.name).join(', ');
                } else {
                    document.getElementById('prof-categories').textContent = 'Sem categorias definidas';
                }
                
                // Preencher atividades
                const activitiesContainer = document.getElementById('prof-activities');
                
                if (professional.activities && professional.activities.length > 0) {
                    let html = '';
                    
                    professional.activities.forEach(activity => {
                        html += `
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h5 class="card-title mb-0">${activity.name}</h5>
                                        <span class="badge bg-primary">${activity.category?.name || 'Sem categoria'}</span>
                                    </div>
                                    <p class="card-text">${activity.description || 'Sem descrição disponível'}</p>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <small class="text-muted">
                                                <i class="bi bi-clock me-1"></i>
                                                ${activity.experience_years ? `${activity.experience_years} anos de experiência` : 'Experiência não informada'}
                                            </small>
                                        </div>
                                        <div>
                                            <strong class="text-primary">
                                                ${activity.price ? `R$ ${parseFloat(activity.price).toFixed(2)}` : 'Preço sob consulta'}
                                            </strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    activitiesContainer.innerHTML = html;
                } else {
                    activitiesContainer.innerHTML = '<div class="alert alert-info">Este profissional não possui atividades cadastradas.</div>';
                }
                
                // Mostrar detalhes e ocultar loading
                document.getElementById('loading-container').classList.add('d-none');
                document.getElementById('professional-details').classList.remove('d-none');
                
                // Atualizar título da página
                document.title = `${professional.name} - Saúde Connect`;
                
            } catch (error) {
                console.error('Erro ao carregar detalhes do profissional:', error);
                showError(error.message);
            }
        }
        
        function showError(message) {
            document.getElementById('loading-container').classList.add('d-none');
            document.getElementById('error-container').classList.remove('d-none');
            document.getElementById('error-message').textContent = message;
        }
        
        async function sendContactMessage(professionalId) {
            try {
                const name = document.getElementById('contact-name').value;
                const email = document.getElementById('contact-email').value;
                const phone = document.getElementById('contact-phone').value;
                const message = document.getElementById('contact-message').value;
                const alertContainer = document.getElementById('contact-alert');
                
                if (!name || !email || !message) {
                    alertContainer.innerHTML = '<div class="alert alert-danger">Por favor, preencha todos os campos obrigatórios.</div>';
                    return;
                }
                
                alertContainer.innerHTML = '<div class="alert alert-info">Enviando mensagem...</div>';
                
                // Simular envio de mensagem (em uma implementação real, isso seria uma chamada de API)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                alertContainer.innerHTML = '<div class="alert alert-success">Mensagem enviada com sucesso! O profissional entrará em contato em breve.</div>';
                
                // Limpar formulário após 3 segundos e fechar modal
                setTimeout(() => {
                    document.getElementById('contact-form').reset();
                    alertContainer.innerHTML = '';
                    bootstrap.Modal.getInstance(document.getElementById('contactModal')).hide();
                }, 3000);
                
            } catch (error) {
                console.error('Erro ao enviar mensagem:', error);
                document.getElementById('contact-alert').innerHTML = `
                    <div class="alert alert-danger">
                        Erro ao enviar mensagem: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
